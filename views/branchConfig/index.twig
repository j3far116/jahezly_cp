{% extends "layout.twig" %}
{% block title %}Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ±ÙˆØ¹ Ø§Ù„Ù…ØªØ¬Ø±{% endblock %}

{% block content %}

<h1 class="h5 mb-4">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ±ÙˆØ¹ Ø§Ù„Ù…ØªØ¬Ø±: {{ market.name }}</h1>

<form method="post" action="/admincp/markets/{{ market.id }}/branch/config/save">
    <input type="hidden" name="_csrf" value="{{ _csrf }}">

    <table class="table table-bordered table-striped align-middle">
        <thead class="table-light">
            <tr>
                <th class="text-center" style="width:240px;">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</th>
                {% for branch in branches %}
                    <th class="text-center">{{ branch.name }}</th>
                {% endfor %}
            </tr>
        </thead>

        <tbody>

        {% for p in branches[0].configs %}
        <tr>
            <th class="fw-bold">{{ p.desc ?: p.key }}</th>

            {% for branch in branches %}
                {% set cfg = branch.configs[loop.parent.loop.index0] %}
                {% set val = (cfg.value is null or cfg.value == '') ? cfg.default : cfg.value %}

                <td>

                    {% if not cfg.editable %}
                    {# ============================
                       ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                       ============================ #}

                        <div class="text-muted small">ğŸ”’ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙØ±Ø¹</div>

                        {% if cfg.val_type == 'text' %}
                            <input type="text" value="{{ val }}" class="form-control bg-light" disabled>

                        {% elseif cfg.val_type == 'textarea' %}
                            <textarea class="form-control bg-light" disabled rows="2">{{ val }}</textarea>

                        {% elseif cfg.val_type == 'switch' %}
                            <div class="form-check form-switch text-center">
                                <input type="checkbox" class="form-check-input" disabled {{ val == '1' ? 'checked' }}>
                            </div>

                        {% elseif cfg.val_type == 'select' %}
                            <select class="form-select bg-light" disabled>
                                {% for opt in cfg.options_arr %}
                                    <option value="{{ opt.value }}" {{ val == opt.value ? 'selected' }}>
                                        {{ opt.label }}
                                    </option>
                                {% endfor %}
                            </select>
                        {% endif %}

                    {% else %}
                    {# ============================
                       Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                       ============================ #}

                        {% set reset_id = "reset-" ~ branch.id ~ "-" ~ cfg.key %}

                        {% if cfg.val_type == 'text' %}
                            <div class="input-group input-group-sm">
                                <input type="text"
                                       name="cfg[{{ branch.id }}][{{ cfg.key }}]"
                                       value="{{ val }}"
                                       class="form-control">

                                <button type="submit"
                                        form="{{ reset_id }}"
                                        class="btn btn-outline-warning ms-1">
                                    â†©
                                </button>
                            </div>

                        {% elseif cfg.val_type == 'textarea' %}
                            <div class="input-group input-group-sm">
                                <textarea name="cfg[{{ branch.id }}][{{ cfg.key }}]"
                                          class="form-control"
                                          rows="2">{{ val }}</textarea>

                                <button type="submit"
                                        form="{{ reset_id }}"
                                        class="btn btn-outline-warning ms-1">
                                    â†©
                                </button>
                            </div>

                        {% elseif cfg.val_type == 'switch' %}
                            <div class="d-flex align-items-center justify-content-between">

                                <div class="form-check form-switch">
                                    <input type="hidden"
                                           name="cfg[{{ branch.id }}][{{ cfg.key }}]"
                                           value="0">

                                    <input type="checkbox"
                                           class="form-check-input"
                                           name="cfg[{{ branch.id }}][{{ cfg.key }}]"
                                           value="1"
                                           {{ val == '1' ? 'checked' }}>
                                </div>

                                <button type="submit"
                                        form="{{ reset_id }}"
                                        class="btn btn-sm btn-outline-warning ms-2">
                                    â†©
                                </button>
                            </div>

                        {% elseif cfg.val_type == 'select' %}
                            <div class="input-group input-group-sm">
                                <select name="cfg[{{ branch.id }}][{{ cfg.key }}]"
                                        class="form-select">
                                    {% for opt in cfg.options_arr %}
                                        <option value="{{ opt.value }}"
                                            {{ val == opt.value ? 'selected' }}>
                                            {{ opt.label }}
                                        </option>
                                    {% endfor %}
                                </select>

                                <button type="submit"
                                        form="{{ reset_id }}"
                                        class="btn btn-outline-warning ms-1">
                                    â†©
                                </button>
                            </div>
                        {% endif %}

                        {# ÙÙˆØ±Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ #}
                        <form id="{{ reset_id }}"
                              method="post"
                              action="/admincp/markets/{{ market.id }}/branch/{{ branch.id }}/config/{{ cfg.key }}/reset"
                              onsubmit="return confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ {{ cfg.key }} Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙØ±Ø¹ØŸ');">
                            <input type="hidden" name="_csrf" value="{{ _csrf }}">
                        </form>

                    {% endif %}

                </td>
            {% endfor %}
        </tr>
        {% endfor %}

        </tbody>
    </table>

    <button class="btn btn-primary">Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>

</form>

{% endblock %}
