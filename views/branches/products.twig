{% extends "layout.twig" %}
{% block title %}منتجات الفرع — {{ branch.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h5 mb-0">منتجات الفرع: {{ branch.name }}</h1>
  <a href="{{ branches_base }}/{{ branch.id }}" class="btn btn-light">رجوع للفرع</a>
</div>

{% if flash('success') %}
  <div class="alert alert-success">{{ flash('success') }}</div>
{% elseif flash('info') %}
  <div class="alert alert-info">{{ flash('info') }}</div>
{% elseif flash('error') %}
  <div class="alert alert-danger">{{ flash('error') }}</div>
{% endif %}

<table class="table table-hover align-middle">
  <thead class="table-light">
    <tr>
      <th>#</th>
      <th>المنتج الأساسي</th>
      <th>السعر الأساسي</th>
      <th>السعر الفرعي</th>
      <th>الاسم الفرعي</th>
      <th>الحالة</th>
      <th>الإجراءات</th>
    </tr>
  </thead>
  <tbody>
    {% for p in products %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ p.base_name }}</td>
      <td>{{ p.base_price }}</td>
      <td>{{ p.override_price ?: '—' }}</td>
      <td>{{ p.override_name ?: '—' }}</td>
<td>
  {% if p.override_status == 'active' %}
    <span class="badge bg-success">مخصص ومفعّل</span>
  {% elseif p.override_status == 'inactive' %}
    <span class="badge bg-secondary">افتراضي</span>
  {% elseif p.override_status == 'disabled' %}
    <span class="badge bg-danger">معطّل في هذا الفرع</span>
  {% else %}
    <span class="text-muted">—</span>
  {% endif %}
</td>
      <td>
        <a href="{{ products_base }}/{{ p.id }}/edit" class="btn btn-sm btn-primary">تخصيص</a>
        {% if p.override_status or p.override_name or p.override_price %}
        <form method="post" action="{{ products_base }}/{{ p.id }}/delete" class="d-inline">
          <input type="hidden" name="_csrf" value="{{ _csrf }}">
          <button class="btn btn-sm btn-danger" onclick="return confirm('هل تريد إلغاء التخصيص؟')">إلغاء</button>
        </form>
        {% endif %}
      </td>
    </tr>
    {% else %}
    <tr><td colspan="7" class="text-center text-muted">لا توجد منتجات</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
