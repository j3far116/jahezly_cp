{% extends "layout.twig" %}
{% block title %}كل الكاشيرات{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h5 mb-1">كل الكاشيرات</h1>
      <div class="text-muted">عرض جميع الكاشيرات في جميع المتاجر — للمدير العام فقط</div>
    </div>
    <form method="get" action="{{ base }}" class="d-flex gap-2">
      <input type="text" class="form-control" name="q" value="{{ q }}" placeholder="بحث بالاسم / اسم المستخدم / المتجر">
      <button class="btn btn-outline-primary" type="submit">بحث</button>
    </form>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>الاسم</th>
          <th>اسم المستخدم</th>
          <th>المتجر</th>
          <th>الحالة</th>
          <th style="width:220px">تحكم</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr>
            <td>{{ r.id }}</td>
            <td>{{ r.name }}</td>
            <td><code>{{ r.username }}</code></td>
            <td>
  <a href="{{ url('/markets') }}/{{ r.market_id }}">{{ r.market_name }}</a>
  <span class="text-muted"> — {{ r.branch_label }}</span>
</td>
            <td>
              {% if r.status == 'active' %}
                <span class="badge bg-success">نشط</span>
              {% elseif r.status == 'suspended' %}
                <span class="badge bg-warning text-dark">معلّق</span>
              {% else %}
                <span class="badge bg-dark">محذوف</span>
              {% endif %}
            </td>
            <td>
              <a class="btn btn-sm btn-outline-primary"
                 href="{{ url('/markets') }}/{{ r.market_id }}/cashiers/{{ r.id }}/edit">تحرير</a>
              <a class="btn btn-sm btn-outline-danger"
   href="{{ url('/markets') }}/{{ r.market_id }}/cashiers/{{ r.id }}/delete/confirm">حذف</a>

            </td>
          </tr>
        {% else %}
          <tr><td colspan="6" class="text-center">لا توجد سجلات.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if totalPages > 1 %}
    <nav aria-label="pagination">
      <ul class="pagination justify-content-center">
        {% set qp = q ? '&q=' ~ q : '' %}
        <li class="page-item {{ page == 1 ? 'disabled' : '' }}">
          <a class="page-link" href="{{ base }}?page={{ page - 1 }}{{ qp }}">السابق</a>
        </li>
        {% for p in range(1, totalPages) %}
          <li class="page-item {{ p == page ? 'active' : '' }}">
            <a class="page-link" href="{{ base }}?page={{ p }}{{ qp }}">{{ p }}</a>
          </li>
        {% endfor %}
        <li class="page-item {{ page == totalPages ? 'disabled' : '' }}">
          <a class="page-link" href="{{ base }}?page={{ page + 1 }}{{ qp }}">التالي</a>
        </li>
      </ul>
    </nav>
  {% endif %}
{% endblock %}
