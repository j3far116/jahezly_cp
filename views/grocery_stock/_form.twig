{{ csrf_field()|raw }}

<div class="row g-3">

    {# ------------------- Ø§Ù„Ù‚Ø±ÙˆØ¨ ------------------- #}
    <div class="col-md-4">
        <label class="form-label">Ø§Ù„Ù‚Ø±ÙˆØ¨</label>
        <select id="groupSelect" class="form-select" required>
            <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø±ÙˆØ¨ â€”</option>
            {% for g in groups %}
                <option value="{{ g.id }}"
                    {% if row is not defined and loop.first %}selected{% endif %}
                    {% if row is defined and row.group_id == g.id %}selected{% endif %}
                >
                    {{ g.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    {# ------------------- Ø§Ù„ØªØµÙ†ÙŠÙ ------------------- #}
    <div class="col-md-4">
        <label class="form-label">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
        <select name="cat_id" id="catSelect" class="form-select" required>
            {% if row is defined %}
                {% for c in cats %}
                    <option value="{{ c.id }}"
                        {% if row.cat_id == c.id %}selected{% endif %}
                    >
                        {{ c.name }}
                    </option>
                {% endfor %}
            {% else %}
                <option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>
            {% endif %}
        </select>
    </div>

    {# ------------------- Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ------------------- #}
    <div class="col-md-4">
        <label class="form-label">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <select name="brand_id" class="form-select">
            <option value="">â€” Ø¨Ø¯ÙˆÙ† Ø¨Ø±Ø§Ù†Ø¯ â€”</option>
            {% for b in brands %}
                <option value="{{ b.id }}"
                    {% if row is defined and row.brand_id == b.id %}selected{% endif %}
                >
                    {{ b.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    {# ------------------- Ø§Ù„ÙˆØ­Ø¯Ø© ------------------- #}
    <div class="col-md-4">
        <label class="form-label">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
        <select name="unit_id" class="form-select" required>
            <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„ÙˆØ­Ø¯Ø© â€”</option>
            {% for u in units %}
                <option value="{{ u.id }}"
                    {% if row is defined and row.unit_id == u.id %}selected{% endif %}
                >
                    {{ u.name }}{% if u.abbreviation %} ({{ u.abbreviation }}){% endif %}
                </option>
            {% endfor %}
        </select>
    </div>

    {# ------------------- Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ ------------------- #}
    <div class="col-md-4">
        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
        <input name="name" class="form-control" value="{{ row.name ?? '' }}" required>
    </div>

    {# ------------------- Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ------------------- #}
    <div class="col-md-4">
        <label class="form-label">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
        <input name="barcode" class="form-control" value="{{ row.barcode ?? '' }}" required>
    </div>

    {# ------------------- Ø§Ù„Ø­Ø¬Ù… ------------------- #}
    <div class="col-md-4">
        <label class="form-label">Ø§Ù„Ø­Ø¬Ù…</label>
        <input name="size" class="form-control" value="{{ row.size ?? '' }}" required>
    </div>

    {# ------------------- Ø§Ù„ØµÙˆØ±Ø© ------------------- #}
    <div class="col-md-4">
        <label class="form-label">Ø§Ù„ØµÙˆØ±Ø©</label>
        <input type="file" name="image" class="form-control">
        {% if row is defined and row.image %}
            <div class="mt-2">
                <img src="/uploads/grocery/{{ row.image }}" style="height:60px;" class="rounded border">
            </div>
        {% endif %}
    </div>

</div>

{# ------------------- JavaScript ------------------- #}
<script>
document.getElementById('groupSelect').addEventListener('change', function () {
    let id = this.value;
    let sel = document.getElementById('catSelect');
    sel.innerHTML = '<option>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>';

    fetch(`/admincp/grocery/groups/${id}/cats`)
        .then(r => r.json())
        .then(list => {
            sel.innerHTML = '';
            if (!Array.isArray(list) || list.length === 0) {
                sel.innerHTML = '<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØµÙ†ÙŠÙØ§Øª</option>';
                return;
            }
            list.forEach(c => {
                let o = document.createElement('option');
                o.value = c.id;
                o.textContent = c.name;
                sel.appendChild(o);
            });
        });
});

{# ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙØªØ­ ØµÙØ­Ø© create #}
document.addEventListener("DOMContentLoaded", function () {
    const groupSelect = document.getElementById("groupSelect");

    // ÙÙŠ ÙˆØ¶Ø¹ create Ø§Ø®ØªØ± Ø£ÙˆÙ„ Ù‚Ø±ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
    if ("{{ row is not defined ? '1' : '0' }}" === "1") {
        if (groupSelect.value !== "") {
            groupSelect.dispatchEvent(new Event("change"));
        }
    }
});
</script>
